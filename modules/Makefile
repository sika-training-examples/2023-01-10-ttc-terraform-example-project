GITLAB_DOMAIN = gitlab.sikademo.com
GITLAB_PROJECT_ID = 2

publish:
ifndef NAME
	$(error NAME is undefined)
endif
ifndef SYSTEM
	$(error SYSTEM is undefined)
endif
ifndef VERSION
	$(error VERSION is undefined)
endif
ifndef GITLAB_TOKEN
	$(error GITLAB_TOKEN is undefined)
endif
	tar -czf ${NAME}-${SYSTEM}-${VERSION}.tgz -C ${NAME} .
	curl --fail-with-body --header "PRIVATE-TOKEN: ${GITLAB_TOKEN}" \
		--upload-file ${NAME}-${SYSTEM}-${VERSION}.tgz \
		"https://${GITLAB_DOMAIN}/api/v4/projects/${GITLAB_PROJECT_ID}/packages/terraform/modules/${NAME}/${SYSTEM}/${VERSION}/file"
